* Module dependencies
Check module dependencies.

#+NAME: CheckModuleDependencies
#+BEGIN_SRC sh :exports both :results output verbatim
./scripts/module-dependencies
#+END_SRC

#+RESULTS: CheckModuleDependencies
: Draw and analyze graphs with 'xdot'.

* Format source files
Format all source files.

#+NAME: CleanFilesStylishHaskell
#+BEGIN_SRC sh :exports both :results output verbatim
./scripts/format-all
#+END_SRC

#+RESULTS: CleanFilesStylishHaskell

* Version
Bump version.

#+NAME: BumpVersion
#+BEGIN_SRC sh :exports both :results output verbatim
./scripts/bump-version minor
#+END_SRC

Recompile project.

* README and Change Log
Update help in [[file:README.org][README.org]] (=, b b=), and [[file:ChangeLog.org][ChangeLog.org]]; export them to Markdown.

Copy files to package directories.
#+NAME: CopyFiles
#+BEGIN_SRC sh :exports both :results output verbatim
for p in elynx-markov elynx-seq elynx-tools elynx-tree slynx tlynx elynx
do
    for f in README.md ChangeLog.md
    do
        cp $f $p/$f
    done
done
#+END_SRC

#+RESULTS: CopyFiles

* Build
Build project, perform tests, build documentation.

#+NAME: Build
#+BEGIN_SRC sh :exports both :results output verbatim
stack build --test --haddock
#+END_SRC

#+RESULTS: Build

* Git
Commit all changes.

Tag new commit with version number created above.

* Distribution tarballs
Create source distribution tarballs.

#+NAME: HackageCreateTarballs
#+BEGIN_SRC sh :exports both :results output verbatim
stack sdist --pvp-bounds both
#+END_SRC

#+RESULTS: HackageCreateTarballs

* Hackage
Upload the source distribution tarballs to Hackage.

Somehow this doesn't work on a project basis, so we have to do it separately for
each package.

#+NAME: HackageUploadTarballs
#+BEGIN_SRC sh :exports both :results output verbatim
for p in elynx-markov elynx-seq elynx-tools elynx-tree slynx tlynx elynx
do
    (cd "$p" || exit 1
    stack upload --pvp-bounds both .)
done
#+END_SRC

#+RESULTS: HackageUploadTarballs
#+begin_example
Uploading elynx-markov-0.2.1.tar.gz... forbidden upload
Usually means: you've already uploaded this package/version combination
Ignoring error and continuing, full message from Hackage below:

Error: Upload failed

This version of the package has already been uploaded.

As a matter of policy we do not allow package tarballs to be changed after a release (so we can guarantee stable md5sums etc). The usual recommendation is to upload a new version, and if necessary blacklist the existing one. In extraordinary circumstances, contact the administrators.
Uploading elynx-seq-0.2.1.tar.gz... forbidden upload
Usually means: you've already uploaded this package/version combination
Ignoring error and continuing, full message from Hackage below:

Error: Upload failed

This version of the package has already been uploaded.

As a matter of policy we do not allow package tarballs to be changed after a release (so we can guarantee stable md5sums etc). The usual recommendation is to upload a new version, and if necessary blacklist the existing one. In extraordinary circumstances, contact the administrators.
Uploading elynx-tools-0.2.1.tar.gz... forbidden upload
Usually means: you've already uploaded this package/version combination
Ignoring error and continuing, full message from Hackage below:

Error: Upload failed

This version of the package has already been uploaded.

As a matter of policy we do not allow package tarballs to be changed after a release (so we can guarantee stable md5sums etc). The usual recommendation is to upload a new version, and if necessary blacklist the existing one. In extraordinary circumstances, contact the administrators.
Uploading elynx-tree-0.2.1.tar.gz... forbidden upload
Usually means: you've already uploaded this package/version combination
Ignoring error and continuing, full message from Hackage below:

Error: Upload failed

This version of the package has already been uploaded.

As a matter of policy we do not allow package tarballs to be changed after a release (so we can guarantee stable md5sums etc). The usual recommendation is to upload a new version, and if necessary blacklist the existing one. In extraordinary circumstances, contact the administrators.
Uploading slynx-0.2.1.tar.gz... forbidden upload
Usually means: you've already uploaded this package/version combination
Ignoring error and continuing, full message from Hackage below:

Error: Upload failed

This version of the package has already been uploaded.

As a matter of policy we do not allow package tarballs to be changed after a release (so we can guarantee stable md5sums etc). The usual recommendation is to upload a new version, and if necessary blacklist the existing one. In extraordinary circumstances, contact the administrators.
Uploading tlynx-0.2.1.tar.gz... forbidden upload
Usually means: you've already uploaded this package/version combination
Ignoring error and continuing, full message from Hackage below:

Error: Upload failed

This version of the package has already been uploaded.

As a matter of policy we do not allow package tarballs to be changed after a release (so we can guarantee stable md5sums etc). The usual recommendation is to upload a new version, and if necessary blacklist the existing one. In extraordinary circumstances, contact the administrators.
Uploading elynx-0.2.1.tar.gz... forbidden upload
Usually means: you've already uploaded this package/version combination
Ignoring error and continuing, full message from Hackage below:

Error: Upload failed

This version of the package has already been uploaded.

As a matter of policy we do not allow package tarballs to be changed after a release (so we can guarantee stable md5sums etc). The usual recommendation is to upload a new version, and if necessary blacklist the existing one. In extraordinary circumstances, contact the administrators.
#+end_example
